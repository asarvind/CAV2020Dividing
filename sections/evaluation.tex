We evaluate our intersection of unions method on three examples, i.e.,
the illustrative Example~\ref{eg:ill} in Section~\ref{sec:system}, a
seven dimensional model of an autonomous car with one input from Lavaei
et. al.~\cite{lavaei2020formal}, and a twelve dimensional model of a quadrotor
from ARCH 2020 workshop~\cite{geretti2020arch}.  For the illustrative
example, we compare the flowpipe accuracy of our intersection of
unions (IoU) method with that of only
\emph{union of interval zonotopes} based on the performance index in
Equation~\ref{eqn:pi} proposed by Althoff
et.al.~\cite{althoff2008reachability}.  
On the other two real world
examples, besides the performance index~(\ref{eqn:pi}), we compare our
method with state-of-the-art methods, i.e., polynomial
zonotopes~\cite{althoff2013reachability} in CORA
tool\footnote{\url{https://tumcps.github.io/CORA/}} and Taylor
models~\cite{chen2012taylor} in
Flowstar\footnote{https://flowstar.org}.

\is{Why don't we apply all these three methods on the three examples?}

For computation of symbolic derivatives, we use Sympy Python
software~\cite{10.7717/peerj-cs.103} and for interval arithmetic, we
use Boost C++ library~\cite{bronnimann2006design}.  We gain
significant speed by running parts of our algorithm in
parallel on mulicore machines.

\subsection{Illustrative example}
We consider the 3-dimensional nonlinear system in Example~\ref{eg:ill}
\is{Does it represent some real system, for example, a bicycle? It would have been nice then.}
to illustrate the difference in accuracy between our IoU flowpipe and
the union flowpipe based on the performance index
in~\cite{althoff2008reachability}(Equation~\ref{eqn:pi} above).  The
initial set has to be large enough to demonstrate the effect of linearization error, which is $X_0 = [-1,1]^3$.

\emph{Settings:}  We ran the both the IoU and unions algorithm on a 1.4 GHz
laptop with 4 GB ram, 1600 MHz DDR3 with 4 virtual cpu cores.  We
consider 3 different number of divisions for comparision, i.e.,
$2^\eta:\eta = 2, 3,4$, or $4, 8$ and $16$ divisions,
respectively. The order of interval zonotope is $l = 200$ and the time
step size is $\delta = 0.01$ s.  Furthermore, $\epsilon = 10^{-12}$
and $K = 20$.  The threhold $\rho$ for division in the union method is
the Taylor error before splitting $\taylor{f}{X_0}{U}$.

\emph{Results:}  The upper and lower bounds on flowpipes at uniformly spaced time
points for the $x$ and $y$ variables is
shown in Figure~\ref{fig:ill}.  The figure clearly demonstrate our IoU
method to be far more accurate than the union method on $x/y$
coordinates.  The bounds for $\theta$ are almost similar for both
methods and all types of divisions because of very less linearization
error $(\le 10^{-6})$.  The computation times for our IoU method are $6\si{\second}$, $12\si{\second}$ and $24\si{\second}$, respectively, for $4$, $8$ and $16$ divisions
per union.  The computation times will reduce significantly by using
more cpu cores, which would be useful for the higher dimensional
examples that we evaluate latter.
%
\begin{figure}
  \includegraphics[scale = 0.7]{illImages/Ub.png}
  %\includegraphics[scale=0.5]{illImages/ub.png}
  \caption{Flowpipe bounds at different time points for
    Example~\ref{eg:ill}}
  \label{fig:ill}
\end{figure}
%
\begin{figure}
\includegraphics[scale = 0.67]{autocarImages/ubToolSteering.png}
\includegraphics[scale = 0.41]{autocarImages/ubToolYaw.png}\hspace{-2.2em}
\includegraphics[scale = 0.41]{autocarImages/ubToolYawRate.png}
\includegraphics[scale = 0.41]{autocarImages/ubToolSlip.png}\hspace{-2.2em}
\includegraphics[scale = 0.41]{autocarImages/ubToolx2.png}
  \caption{Flowpipe bounds at different time points\\ for
    car model~\ref{eg:ill}}\label{fig:flowcar}
\end{figure}
%
\subsection{$7$-dimensional model of autonomous car}
A time discretized model of autonomous manoeuvre with $7$-dimensional
state space and $2$ inputs was presented in~\cite{lavaei2020formal}.
We adapt this example into a continuous time system and provide a
stabilizing feedback for one of the inputs.  Then we have the
following $7$-dimensional system having only one
uncontrolled input.
%
\begin{align*}
\dot{x_1}  = & x_4\cos\rb{x_5+x_7}\hspace{2em} \dot{x_2} =
x_4\sin\rb{x_5+x_7}\\
%
\dot{x_3}  = & -r(x_5+x_7+x_3) \hspace{2em} \dot{x_4} =
 u \hspace{2em} \dot{x_5} = x_6 & \\
 %
 \dot{x_6}  = & \frac{\mu
 m}{I_z(l_r+l_f)}(l_fC_{Sf}(gl_r-uh_{cg})x_3+
 (l_rC_{Sr}(gl_f+uh_{cg})\\& -l_fC_{Sf}(gl_r-uh_{cg}))x_7
 -(l_fl_fC_{Sf}(gl_r-uh_{cg}) + l_rl_rC_{Sr}(gl_f+uh_{cg}))\frac{x_6}{x_4})\\
%
\dot{x_7} 
= & \frac{\mu}{x_4(l_r+l_f)}(C_{Sf}(gl_r-uh_{cg})x_3+(C_{Sr}(gl_f+uh_{cg})-C_{Sf}(gl_r-uh_{cg}))x_7\\
&-(l_f*C_{Sf}(gl_r-uh_{cg}) + l_rC_{Sr}(gl_f+uh_{cg}))x_6/x_4)-x_6
\end{align*}
%
Above, $x = \rb{x_1,\ldots,x_7}^T$ represents the state vector and $u$
is the input, while rest are constant parameters.  The 2-D position of
car is $(x_1,x_2)$, steering angle is $x_3$, heading velocity is
$x_4$, yaw angle is $x_5$, yaw rate is $x_6$ and slip angle is $x_7$.
The parameter values are
%
$ g = 9.81, m = 1093.3, \mu = 1.0489, l_f = 1.156, l_r = 1.422, h_{cg}
  = 0.574, I_z = 1791.6, C_{Sf} = 20.89, C_{Sr} = 20.89, r = 4 $.  We
  consider the input set $u\in U = [-0.01,0.01]$ and the initial set
  $X_0 = b[-1,1]\times[-0.5,0.5]\times[-0.5,0.5]\times[5,6]\times[-0.25,0.25]\times[-0.2,0.2]\times[-0.25,0.25]$.
We compare our IoU method with the union method~(Equation~\ref{eqn:pi}) and
  also Taylor models in Flowstar and polynomial zonotopes in CORA.

\emph{Settings:}  The simulation time step is $\delta = 0.005$ s.  For
  Flowstar Taylor model, the order of Taylor expansion is $9$.  For
  the polynomial zonotope, generator order is $400$ and order of
  dependent generators is $2000$.  The zonotope order of our IoU
  method and the union method is $l=400$.  Also, $K = 20$ and
  $\epsilon = 10^{-12}$.  For the only union method, the normalization error
  error $\rho$ for division is the Taylor error before division
  $\taylor{f}{X_0}{u}$.  We ran our IoU method and the union method on
  an AWS c5a.16xlarge cluster with 64 virtual cpus.  For Flowstar, we
  used AWS t2.large instance.  We ran CORA in MATLAB 2019a on the
  computer specified in the previous illustrative example.

\emph{Results:}  The upper and lower bounds of flowpipe for different
  methods is plotted over times in $[0 s,5 s]$ in
  Figure~\ref{fig:flowcar}.  But Flowstar could not complete the Taylor
  model flowpipe simulation beyond 1.15 secs due to large
  discretization error.  The bottom 3 lines in the figure correspond
  to our IoU flowpipe method, which show convergence while all other
  plots are diverging.  The figure clearly shows a high increase in
  accuracy by using intersection of unions compared to other methods.
  The simulation times are given in Table~\ref{tab:times}.  The
  preprocessing time before simulation for IoU method is 18s.
  %
\subsection{$12$-dimensional model of quadrotor}
We consider the $12$-dimensional model of quadrotor with three inputs
presented in the ARCH 2020 friendly
competition~\cite{geretti2020arch}, whose dynamics is described in the
appendix.  It has a $12$-dimensional state vector $x
= \rb{p_n,p_e,h,u,v,w,\phi,\theta,\psi,p,q,r}$, where $h$ is the
height of the quadrotor and a $3$-dimensional input vector $u
= \rb{u_1,u_2,u_2}$.  We take a much larger initial set that that
given in~\cite{geretti2020arch} so that there is significant
linearization error in the flowpipe.  Our initial set is $X_0 =
[-0.8,0.8]^6\times[-0.5,0.5]^2\times[0,0]\times [-1,1]^2\times[0,0]$.
The input set is $\rb{u_1,u_2,u_3}\in
[-0.99,1.01]\times[-0.01,0.01]^2$.

\emph{Settings:}  The simulation time step is $\delta = 0.01$ s.  For
  Flowstar Taylor model, the order of Taylor expansion is $7$.  For
  the polynomial zonotope, generator order is $200$ and order of
  dependent generators is $2000$.  The zonotope order of our IoU
  method and the union method is $l=200$.  Also, $K = 20$ and
  $\epsilon = 10^{-12}$.  For the only union method, we take the
  normalization erro $\rho$ as the Taylor error before division
  $\taylor{f}{X_0}{u}$.  But lead to high time discretization error
  and the simulation could not finish.  We ran our IoU method and the
  union method on an AWS c5a.16xlarge cluster with 64 virtual cpus.
  For Flowstar, we used AWS t2.large instance.  We ran CORA in MATLAB
  2019a on the computer specified in the previous illustrative
  example.  The simulation time horizon is $[0, 5 s]$.

\emph{Results:}  Our IoU method for each of the $8$, $16$ and $32$ divisions per
  eigenvector direction showed much higher accuracy than other
  methods.  The union method based on division using
  Equation~\ref{eqn:pi} from
  Althoff. et. al.~\cite{althoff2013reachability} could not finish
  simulation beyond when the normalization error is taken to be the
  linearization error before division, i.e., $\rho
  = \taylor{f}{X_0}{u}$.  This illustrates another drawback of the
  performance index proposed in~\cite{althoff2013reachability} that we
  do not know what is a good normalization error.  We plotted the
  flowpipe bounds for the height in Figure~\ref{fig:flowquadrotor},
  which shows clearly high increase in accuracy by using intersection
  of unions compared to other methods.
%
\begin{table}
\caption{Computation times}
\begin{tabular}{|l|c|c|c|c|c|}
\hline
Example & IoU $\eta = 5$ & IoU $\eta = 4$ & IoU $\eta = 3$ &
Polynomial & Taylor\\
& & & & Zonotope & Model \\
\hline
& & & & & {\color{red}Incomplete horizon}\\
Car & 252 s & 128 s & 108 s & 4068 s& {\color{red}[0,1.15s]:~216s}\\
\hline
& & & & &\\
Quadrotor & 169 s & 318 s & 614 s & 2382 s &
{\color{red}[0,4.13s]:~583 s} \\
\hline
\end{tabular}
\end{table}
%
\begin{figure}
%\vspace{-1.05em}
\includegraphics[scale = 0.65]{quadrotorImages/ubToolHeight.png}\vspace{-0.4em}
\includegraphics[scale = 0.6]{quadrotorImages/lbToolHeight.png}
\caption{Flowpipe bounds on height at different time points.\\
Note: Union method could not complete simulation (not plotted).}\label{fig:flowquadrotor}
\end{figure}
